define("scalejs.functional/functional",[],function(){function n(){var e=Array.prototype.slice.call(arguments,0).reverse();return function(){var t=e.reduce(function(e,t){return[t.apply(undefined,e)]},Array.prototype.slice.call(arguments));return t[0]}}function r(){var e=Array.prototype.slice.call(arguments,0);return function(){var t=e.reduce(function(e,t){return[t.apply(undefined,e)]},Array.prototype.slice.call(arguments,0));return t[0]}}function i(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return t.apply(e,n.concat(Array.prototype.slice.call(arguments,0)))}}function s(e,t){return function(){return e.apply(undefined,Array.prototype.slice.call(arguments,0,t))}}function o(){var t=Array.prototype.slice.call(arguments,0),n=t.reduce(function(t,n,r){return n===e?t.concat([r]):t},[]);return n.length===0?t[0].apply(undefined,t.slice(1)):function(){var e;for(e=0;e<Math.min(n.length,arguments.length);e+=1)t[n[e]]=arguments[e];return o.apply(undefined,t)}}var e={},t;return t=function(e,n){if(arguments.length===1)return t(e,e.length);var r=Array.prototype.slice.call(arguments,2);return r.length>=n?e.apply(this,r):function(){var i=r.concat(Array.prototype.slice.call(arguments,0));return i.unshift(e,n),t.apply(this,i)}},{_:e,compose:n,sequence:r,bind:i,aritize:s,curry:t,partial:o}}),define("scalejs.functional/builder",["scalejs!core"],function(e){function n(e){function i(e){if(!e||e.kind!=="$")return typeof e=="function"?e.bind(r):e;if(typeof e.expr=="function")return e.expr.call(r);if(typeof e.expr=="string")return r[e.expr];throw new Error("Parameter in $(...) must be either a function or a string referencing a binding.")}function s(e,s,o){function u(e){return e==="$return"||e==="$RETURN"||e==="$yield"||e==="$YIELD"}if(typeof r[e]!="function"&&e!=="$then"&&e!=="$else")throw new Error("This control construct may only be used if the computation expression builder defines a `"+e+"` method.");var a=i(s),f;if(o.length>0&&typeof r.combine!="function")throw new Error("This control construct may only be used if the computation expression builder defines a `combine` method.");if(u(e)){if(o.length===0)return r[e](a);if(typeof r.delay!="function")throw new Error("This control construct may only be used if the computation expression builder defines a `delay` method.");return r.combine(r[e](a),r.delay(function(){return n(o)}))}if(e==="$for")return r.combine(r.$for(s.items,function(e){var i=t.copy(s.cexpr);return r[s.name]=e,n(i)}),n(o));if(e==="$while"){if(typeof r.delay!="function")throw new Error("This control construct may only be used if the computation expression builder defines a `delay` method.");return a=r.$while(s.condition.bind(r),r.delay(function(){var e=t.copy(s.cexpr);return n(e)})),o.length>0?r.combine(a,n(o)):a}return e==="$then"||e==="$else"?(f=t.copy(s.cexpr),r.combine(n(f),o)):r.combine(r[e](a),n(o))}var n,r;return e.missing||(e.missing=function(e){throw e.kind?new Error('Unknown operation "'+e.kind+'". '+"Either define `missing` method on the builder or fix the spelling of the operation."):new Error("Expression "+JSON.stringify(e)+" cannot be processed. "+"Either define `missing` method on the builder or convert expression to a function.")}),n=function(e){var o;e=t.copy(e);if(e.length===0){if(r.zero)return r.zero();throw new Error("Computation expression builder must define `zero` method.")}o=e.shift();if(o.kind==="let")return r[o.name]=i(o.expr),n(e);if(o.kind==="do")return o.expr.call(r),n(e);if(o.kind==="letBind")return r.bind(o.expr,function(t){return r[o.name]=t,n(e)});if(o.kind==="doBind"||o.kind==="$"){if(e.length>0)return r.bind(o.expr,function(){return n(e)});if(typeof r.$return!="function")throw new Error("This control construct may only be used if the computation expression builder defines a `$return` method.");return r.bind(o.expr,function(){return r.$return()})}return o.kind==="$return"||o.kind==="$RETURN"||o.kind==="$yield"||o.kind==="$YIELD"?s(o.kind,o.expr,e):o.kind==="$for"||o.kind==="$while"?s(o.kind,o,e):o.kind==="$if"?o.condition.call(r)?s("$then",o.thenExpr,e):o.elseExpr?s("$else",o.elseExpr,e):s(n([]),e):typeof o=="function"&&r.call?(r.call(o),n(e)):typeof o=="function"?(o.call(r),n(e)):s("missing",o,e)},function(){function o(){var e={mixins:Array.prototype.slice.call(arguments,0)},t=s.bind(e);return t.mixin=function(){return Array.prototype.push.apply(e.mixins,arguments),t},t}var i=t.copy(arguments),s=function(){var t=Array.prototype.slice.call(arguments,0),s,o,u;return r={},Object.keys(e).forEach(function(t){r[t]=e[t]}),this.mixins&&this.mixins.forEach(function(e){e.beforeBuild&&e.beforeBuild(t)}),u=function(){return n(t)},!r.run&&!r.delay?s=u():(r.delay&&(o=u,u=function(){return r.delay(o)}),s=u(),r.run&&(s=r.run.apply(r,[s].concat(i)))),this.mixins&&this.mixins.forEach(function(e){e.afterBuild&&(s=e.afterBuild(s))}),s};return s.mixin=o,s}}var t=e.array;return n.$let=function(e,t){return{kind:"let",name:e,expr:t}},n.$LET=function(e,t){return{kind:"letBind",name:e,expr:t}},n.$do=function(e){return{kind:"do",expr:e}},n.$DO=function(e){return{kind:"doBind",expr:e}},n.$return=function(e){return{kind:"$return",expr:e}},n.$RETURN=function(e){return{kind:"$RETURN",expr:e}},n.$yield=function(e){return{kind:"$yield",expr:e}},n.$YIELD=function(e){return{kind:"$YIELD",expr:e}},n.$for=function(e,t){var n=Array.prototype.slice.call(arguments,2);return{kind:"$for",name:e,items:t,cexpr:n}},n.$while=function(e){if(arguments.length<2)throw new Error('Incomplete `while`. Expected "$while(<condition>, <expr>)".');var t=Array.prototype.slice.call(arguments,1);return{kind:"$while",condition:e,cexpr:t}},n.$if=function(e,t,n){if(arguments.length<2)throw new Error('Incomplete conditional. Expected "$if(<expr>, $then(expr))" or "$if(<expr>, $then(<expr>), $else(<expr>)"');if(typeof e!="function")throw new Error("First argument must be a function that defines the condition of $if.");if(t.kind!=="$then")throw new Error('Unexpected "'+t.kind+'" in the place of "$then"');if(n&&n.kind!=="$else")throw new Error('Unexpected "'+n.kind+'" in the place of "$else"');return{kind:"$if",condition:e,thenExpr:t,elseExpr:n}},n.$then=function(){var e=Array.prototype.slice.call(arguments,0);if(e.length===0)throw new Error("$then should contain at least one expression.");return{kind:"$then",cexpr:e}},n.$else=function(){var e=Array.prototype.slice.call(arguments,0);if(e.length===0)throw new Error("$else should contain at least one expression.");return{kind:"$else",cexpr:e}},n.$=function(e){return{kind:"$",expr:e}},n}),define("scalejs.functional/completeBuilder",["./builder"],function(e){var t=e({bind:function(e,t){return function(n){return e.bind(this)(function(e){var r=t(e);r.bind(this)(n)}.bind(this))}},$return:function(e){return function(t){t&&t(e)}}});return t()}),define("scalejs.functional",["scalejs!core","./scalejs.functional/functional","./scalejs.functional/builder","./scalejs.functional/completeBuilder"],function(e,t,n,r){var i=e.object.merge;e.registerExtension({functional:i(t,{builder:n,builders:{complete:r}})})});